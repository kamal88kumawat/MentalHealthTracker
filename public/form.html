<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mental Health Tracker Form</title>
    <link rel="stylesheet" href="css/form.css" />
  </head>
  <body>
    <div class="form-container">
      <h1>Mental Health Tracker</h1>
      <form id="mentalForm" method="POST" action="/submit">
        <!-- Personal Info -->
        <h2>Personal Info</h2>
        <div class="form-group">
          <label for="name">Full Name:</label>
          <input type="text" id="name" name="name" required />
        </div>
        <div class="form-group">
          <label for="age">Age:</label>
          <input type="number" id="age" name="age" required />
        </div>
        <div class="form-group">
          <label for="gender">Gender:</label>
          <select id="gender" name="gender" required>
            <option value="">--Select--</option>
            <option>Female</option>
            <option>Male</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="occupation">Occupation/Student:</label>
          <input type="text" id="occupation" name="occupation" />
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required />
        </div>

        <!-- Mental Health Check -->
        <h2>Mental Health Check</h2>
        <div class="form-group">
          <label for="stress">On a scale of 1‚Äì10, how stressed are you?</label>
          <input type="range" id="stress" name="stress" min="1" max="10" />
        </div>

        <div class="form-group">
          <p>How often do you feel anxious or overwhelmed?</p>
          <div class="options">
            <label
              ><input type="radio" name="anxiety" value="rarely" />
              Rarely</label
            >
            <label
              ><input type="radio" name="anxiety" value="sometimes" />
              Sometimes</label
            >
            <label
              ><input type="radio" name="anxiety" value="often" /> Often</label
            >
            <label
              ><input type="radio" name="anxiety" value="always" /> Almost
              Always</label
            >
          </div>
        </div>

        <div class="form-group">
          <p>How is your sleep quality?</p>
          <div class="options">
            <label
              ><input type="radio" name="sleep" value="good" /> Always
              good</label
            >
            <label
              ><input type="radio" name="sleep" value="disturbed" /> Sometimes
              disturbed</label
            >
            <label
              ><input type="radio" name="sleep" value="rarely" /> Rarely
              good</label
            >
            <label
              ><input type="radio" name="sleep" value="bad" /> Almost never
              good</label
            >
          </div>
        </div>

        <div class="form-group">
          <p>Do you have someone to talk to when stressed?</p>
          <div class="options">
            <label
              ><input type="radio" name="support" value="yes" /> Yes,
              always</label
            >
            <label
              ><input type="radio" name="support" value="sometimes" />
              Sometimes</label
            >
            <label><input type="radio" name="support" value="no" /> No</label>
          </div>
        </div>

        <div class="form-group">
          <p>How often do you exercise or stay active?</p>
          <div class="options">
            <label
              ><input type="radio" name="exercise" value="daily" /> Daily</label
            >
            <label
              ><input type="radio" name="exercise" value="weekly" /> Few times a
              week</label
            >
            <label
              ><input type="radio" name="exercise" value="rarely" />
              Rarely</label
            >
            <label
              ><input type="radio" name="exercise" value="never" /> Never</label
            >
          </div>
        </div>

        <div class="form-group">
          <p>How comfortable are you seeking professional help?</p>
          <div class="options">
            <label
              ><input type="radio" name="help" value="comfortable" /> Very
              comfortable</label
            >
            <label
              ><input type="radio" name="help" value="maybe" /> Maybe</label
            >
            <label
              ><input type="radio" name="help" value="not" /> Not at all</label
            >
          </div>
        </div>

        <div class="form-group">
          <p>What are your main stress reasons?</p>
          <div class="checkbox-options">
            <label
              ><input type="checkbox" name="stress_reasons" value="studies" />
              Studies/Work</label
            >
            <label
              ><input
                type="checkbox"
                name="stress_reasons"
                value="relationships"
              />
              Relationships</label
            >
            <label
              ><input type="checkbox" name="stress_reasons" value="family" />
              Family</label
            >
            <label
              ><input type="checkbox" name="stress_reasons" value="finance" />
              Financial issues</label
            >
            <label
              ><input type="checkbox" name="stress_reasons" value="social" />
              Social Media</label
            >
            <label
              ><input type="checkbox" name="stress_reasons" value="other" />
              Other</label
            >
          </div>
        </div>

        <div class="form-group">
          <label for="motivation">What motivates you during tough times?</label>
          <textarea id="motivation" name="motivation" rows="3"></textarea>
        </div>

        <div class="form-group">
          <p>Which emoji best describes your current mood?</p>
          <div class="mood">üòÄ üòç üòå üòï üò¢ üò° üò¥</div>
        </div>

        <!-- Submit Button -->
        <button type="submit">Submit</button>
      </form>

      <!-- Download & Email Buttons -->
      <button id="downloadBtn" disabled>Download Report</button>
      <button id="emailBtn" disabled>Send Report via Email</button>
    </div>

    <!-- AJAX Script -->
    <script>
      const form = document.getElementById("mentalForm");
      const downloadBtn = document.getElementById("downloadBtn");
      const emailBtn = document.getElementById("emailBtn");

      let pdfUrl = "";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const age = document.getElementById("age").value;
        const email = document.getElementById("email").value;

        // Minimal payload expected by backend; set a default mood
        const payload = { name, age, email, mood: "neutral" };

        try {
          const res = await fetch("http://localhost:10000/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await res.json();
          if (res.ok) {
            alert("Report generated!");
            pdfUrl = `http://localhost:10000${data.pdf_url || "/download"}`;
            downloadBtn.disabled = false;
            emailBtn.disabled = false;
          } else {
            alert(data.error || "Failed to generate report");
          }
        } catch (err) {
          alert("Network error. Is the backend running on port 10000?");
        }
      });

      downloadBtn.addEventListener("click", () => {
        if (pdfUrl) window.location.href = pdfUrl;
      });

      emailBtn.addEventListener("click", async () => {
        const name = document.getElementById("name").value;
        const age = document.getElementById("age").value;
        const email = document.getElementById("email").value;
        if (!email) {
          alert("Enter your email");
          return;
        }

        const payload = { name, age, email, mood: "neutral" };
        try {
          const res = await fetch("http://localhost:10000/send_email", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await res.json();
          if (res.ok) {
            alert(data.message || "Report sent to your email!");
          } else {
            alert(data.error || "Failed to send email");
          }
        } catch (err) {
          alert("Network error. Is the backend running on port 10000?");
        }
      });
    </script>
  </body>
</html>

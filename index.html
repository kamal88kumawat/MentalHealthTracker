<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mental Health Awareness Campaign</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="hero">
      <div class="hero-content">
        <h1>Mental Health Tracker</h1>
        <p>Your mental health matters ‚Äî let‚Äôs prioritize it together.</p>
      </div>
    </header>

    <section class="about">
      <h2>What is Mental Health?</h2>
      <div class="content">
        <img src="mental-health.avif" alt="Mental Health Awareness" />
        <p>
          Mental health includes our emotional, psychological, and social
          well-being. It affects how we think, feel, and act, and it also
          impacts how we handle stress, relate to others, and make choices. Good
          mental health is essential at every stage of life.
        </p>
      </div>

      <h2>About The Tracker</h2>
      <div class="content">
        <img src="campaign-image.png" alt="Campaign" />
        <p>
          This Mental Health Tracker helps you understand your emotional
          well-being. You can track your mental health by filling the short form
          below and getting a personalized report.
        </p>
      </div>
    </section>

    <section class="cta">
      <h2>Track your Mental Health</h2>
      <form id="mentalHealthForm">
        <input type="text" id="name" placeholder="Enter your name" required />
        <input type="email" id="email" placeholder="Enter your email" required />
        <input type="number" id="age" placeholder="Enter your age" required />
        <input
          type="number"
          id="weight"
          placeholder="Enter your weight (kg)"
          required
        />
        <select id="mood" required>
          <option value="">Select your mood</option>
          <option value="happy">Happy</option>
          <option value="neutral">Neutral</option>
          <option value="sad">Sad</option>
          <option value="stressed">Stressed</option>
        </select>
        <button type="submit" id="submitBtn">Submit & Generate Report</button>
      </form>

      <div id="message"></div>
      <button id="downloadBtn" style="display: none">Download Report</button>
      <button id="emailBtn" style="display: none">Send Report via Email</button>
    </section>

    <!-- Chatbot Section (unchanged) -->
    <div class="chatbot-container">
      <img
        src="https://cdn-icons-png.flaticon.com/512/4712/4712023.png"
        alt="Chatbot Logo"
      />
      <span>Chat with us</span>
    </div>

    <div class="chatbot-window" id="chatbotWindow">
      <div class="chat-header">
        <img
          src="https://cdn-icons-png.flaticon.com/512/4712/4712023.png"
          alt="Chatbot Logo"
        />
        <span>Mental Health Chat</span>
        <button onclick="toggleChat()" class="close-btn">‚úñ</button>
      </div>
      <div class="chat-body" id="chatMessages"></div>
      <input
        type="text"
        id="chatInput"
        placeholder="Type a message..."
        onkeydown="if(event.key==='Enter'){sendChat()}"
      />
    </div>

    <footer>
      <p>&copy; 2025 Mental Health Tracker | Helpline: 1800-123-4567</p>
    </footer>

    <script>
      const backendURL = "https://mentalhealthtracker-3.onrender.com";

      const form = document.getElementById("mentalHealthForm");
      const downloadBtn = document.getElementById("downloadBtn");
      const emailBtn = document.getElementById("emailBtn");
      const messageDiv = document.getElementById("message");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const data = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          age: document.getElementById("age").value,
          weight: document.getElementById("weight").value,
          mood: document.getElementById("mood").value,
        };

        messageDiv.innerText = "‚è≥ Generating your report...";

        try {
          const res = await fetch(`${backendURL}/submit`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await res.json();

          if (result.error) {
            messageDiv.innerText = "‚ùå " + result.error;
            return;
          }

          messageDiv.innerText = `‚úÖ ${result.message} | Status: ${result.status}`;
          downloadBtn.style.display = "inline-block";
          emailBtn.style.display = "inline-block";
        } catch (err) {
          messageDiv.innerText = "‚ùå Server error: " + err;
        }
      });

      downloadBtn.addEventListener("click", () => {
        window.open(`${backendURL}/download`, "_blank");
      });

      emailBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value;
        if (!email) {
          alert("Please enter your email first!");
          return;
        }

        messageDiv.innerText = "üì§ Sending report to your email...";

        try {
          const res = await fetch(`${backendURL}/send_email`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ email }),
          });
          const result = await res.json();
          if (result.message) messageDiv.innerText = "‚úÖ " + result.message;
          else messageDiv.innerText = "‚ùå " + result.error;
        } catch (err) {
          messageDiv.innerText = "‚ùå Email sending failed: " + err;
        }
      });
    </script>
  </body>
</html>
